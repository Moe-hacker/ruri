# 增强容器安全性

这里有一些增强 ruri 容器安全性的方法，请在使用 ruri 之前阅读此文档

## 常规

### 运行无根容器

如果您的设备支持用户命名空间，您可以安装 uidmap 并使用 `-r` 选项以普通用户运行容器，从而避免使用根权限运行容器

### 在容器中以普通用户运行命令

如果无法运行无根容器，您可以选择在容器中添加一个普通用户并使用 `-E username` 选项以普通用户运行命令，而不是根用户

如果不需要任何特权，最好同时启用 no_new_privs

### Hidepid

ruri 支持 hidepid 选项，使用 `-i 1/2` 启用它

### Capabilities

ruri 会自动丢弃不需要的能力，但 ruri 也提供了能力控制功能，您可以阅读 capabilities(7) 并使用 `-d` 选项过滤掉容器中不需要的能力

### 禁用 .rurienv

ruri 会在容器中创建 /.rurienv 文件，以避免安全问题，此文件是不可变的且只读。

您也可以使用 `-N` 选项禁用创建它

### 设置内存限制

ruri 支持内存限制，您可以使用 `-l` 选项设置内存限制

### 启用 unshare

ruri 支持 unshare，建议启用此功能以提高安全性

Unshare 容器将使用 pivot_root(2) 代替 chroot(2)，因此它更安全

### 挂载其他挂载点为只读

ruri 支持使用 `-m` 选项挂载其他设备/img/目录到容器中，如果您只需要读取挂载点，请使用 `-M` 选项使它们只读

## Geek

### Seccomp

ruri 有一个内置的 seccomp 配置文件，您可以使用 `-s` 选项启用它

如果此配置文件不符合您的需求，您可以编辑 src/seccomp.c 并编写自己的 seccomp 规则

### 拒绝系统调用

如果您只想拒绝一个系统调用，您可以使用 `-X` 选项，这将只设置 SCMP_ACT_KILL 为此系统调用

例如：`-X unshare -X chroot`

## Radical

### 不提升权限

ruri 支持使用 `-n` 选项启用 no_new_privs 位，启用此选项后，普通用户将无法使用 `sudo` 等命令

### 挂载 / 为只读

ruri 支持使用 `-R` 选项挂载容器根文件系统为只读，这将使容器中的所有内容都只读

### 不创建运行时目录

如果启用 `-j` 选项，/dev, /proc 和 /sys 将不会被挂载

### 禁用网络

您可以使用 `-x` 选项创建一个新的 net ns 并禁用容器中的网络
